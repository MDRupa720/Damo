<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student List</title>
  <style>
    :root {
      --bg1: #89f7fe;
      --bg2: #66a6ff;
      --card:#fff;
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Arial;
      color:var(--text);
      background: linear-gradient(270deg, var(--bg1), var(--bg2));
      background-size: 400% 400%;
      animation: gradientMove 12s ease infinite;
      min-height: 100vh;
      padding: 20px;
    }
    @keyframes gradientMove {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .container{
      max-width:950px;
      margin:auto;
      padding:16px;
      background:rgba(255,255,255,0.8);
      border-radius:14px;
      box-shadow:0 4px 15px rgba(0,0,0,0.1);
    }
    h1{font-size:22px;margin-bottom:14px;text-align:center}
    .search-wrap{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:10px;
      padding:14px;
      box-shadow:0 1px 2px rgba(0,0,0,.03);
      margin-top:8px
    }
    .search-row{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:10px
    }
    .search-row input[type="text"]{
      flex:1;height:36px;
      border:1px solid var(--border);
      border-radius:8px;
      padding:0 12px;
      font-size:14px;
      outline:none
    }
    .filters-row{
      display:flex;
      justify-content:space-between;
      align-items:center
    }
    label{font-size:13px;color:var(--muted)}
    .tiny-select{
      width:50px;height:20px;
      font-size:12px;
      padding:0 2px;
      border:1px solid var(--border);
      border-radius:4px;
      background:#fff;
      appearance:none;
      background-image:linear-gradient(45deg,transparent 50%,#999 50%),linear-gradient(135deg,#999 50%,transparent 50%);
      background-position:calc(100% - 12px) 8px, calc(100% - 6px) 8px;
      background-size:6px 6px,6px 6px;
      background-repeat:no-repeat;
    }
    .meta-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin:10px 2px;
      color:var(--muted);
      font-size:13px
    }
    .badge{
      display:inline-block;
      padding:2px 8px;
      border:1px solid var(--border);
      border-radius:999px;
      font-size:12px;
      color:var(--muted)
    }
    .list{
      list-style:none;
      padding:0;
      margin:0;
      display:grid;
      grid-template-columns:1fr;
      gap:10px
    }
    .item{
      display:flex;
      gap:12px;
      align-items:center;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      box-shadow:0 2px 5px rgba(0,0,0,0.05);
    }
    .avatar{
      width:44px;height:44px;
      border-radius:8px;
      object-fit:cover;
      flex:0 0 44px;
      border:1px solid var(--border);
      background:#fafafa
    }
    .info{display:flex;flex-direction:column;gap:4px}
    .name{font-weight:600}
    .sub{color:var(--muted);font-size:13px}
    .spacer{flex:1}
    .empty,.error,.loading{
      text-align:center;
      color:var(--muted);
      padding:18px 0;
      font-size:14px
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h1>
    <div class="search-wrap">
      <div class="search-row">
        <input id="searchInput" type="text" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: Akash)" aria-label="Search by name"/>
      </div>
      <div class="filters-row">
        <div class="left">
          <label for="rollFilter">Roll:</label>
          <select id="rollFilter" class="tiny-select">
            <option value="All">All</option>
          </select>
        </div>
        <div class="right">
          <label for="classFilter">Class:</label>
          <select id="classFilter" class="tiny-select">
            <option value="All">All</option>
            <option value="Play">Play</option>
            <option value="Nursery">Nursery</option>
            <option value="Kg">Kg</option>
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="6">6</option>
            <option value="7">7</option><option value="8">8</option>
            <option value="9">9</option><option value="10">10</option>
          </select>
        </div>
      </div>
    </div>

    <div class="meta-row">
      <div id="resultCount" class="badge">‡¶Æ‡ßã‡¶ü: 0</div>
      <div id="activeFilters" class="sub"></div>
    </div>

    <ul id="resultList" class="list"></ul>
    <div id="stateMsg" class="empty" style="display:none;"></div>
  </div>

<script>
const API_URL = 'form.php';
const resultList = document.getElementById('resultList');
const stateMsg = document.getElementById('stateMsg');
const resultCount = document.getElementById('resultCount');
const activeFilters = document.getElementById('activeFilters');
const searchInput = document.getElementById('searchInput');
const rollFilter = document.getElementById('rollFilter');
const classFilter = document.getElementById('classFilter');

// Fill rolls
(function(){
  const frag = document.createDocumentFragment();
  for (let i = 1; i <= 100; i++) {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i;
    frag.appendChild(opt);
  }
  rollFilter.appendChild(frag);
})();

function debounce(fn, delay=300){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), delay); }; }
function showState(msg, type='empty'){ stateMsg.textContent=msg; stateMsg.className=type; stateMsg.style.display='block'; }
function clearState(){ stateMsg.style.display='none'; }
function setCount(n){ resultCount.textContent = '‡¶Æ‡ßã‡¶ü: ' + n; }
function setActiveFilters(){
  const s = searchInput.value.trim(), c = classFilter.value, r = rollFilter.value;
  const bits = [];
  if (s) bits.push('‡¶®‡¶æ‡¶Æ: "'+s+'"');
  if (c !== 'All') bits.push('‡¶ï‡ßç‡¶≤‡¶æ‡¶∏: '+c);
  if (r !== 'All') bits.push('‡¶∞‡ßã‡¶≤: '+r);
  activeFilters.textContent = bits.length ? '‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞: ' + bits.join(' ¬∑ ') : '';
}

function renderList(students){
  resultList.innerHTML = '';
  if (!students || !students.length){
    setCount(0);
    showState('‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø üôÇ‡•§','empty');
    return;
  }
  clearState();
  setCount(students.length);
  const frag = document.createDocumentFragment();
  for (const s of students){
    const li = document.createElement('li');
    li.className = 'item';
    const img = document.createElement('img');
    img.className = 'avatar';
    img.src = 'student.png';
    const info = document.createElement('div');
    info.className = 'info';
    const name = document.createElement('div');
    name.className = 'name';
    name.textContent = s.name;
    const sub = document.createElement('div');
    sub.className = 'sub';
    sub.textContent = '‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø: '+s['class']+' ¬∑ ‡¶∞‡ßã‡¶≤: '+s.roll;
    info.appendChild(name);
    info.appendChild(sub);
    li.appendChild(img);
    li.appendChild(info);
    frag.appendChild(li);
  }
  resultList.appendChild(frag);
}

async function fetchData(){
  setActiveFilters();
  showState('‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...','loading');
  const params = new URLSearchParams({
    action:'list',
    search: searchInput.value.trim(),
    class: classFilter.value,
    roll: rollFilter.value,
    _t: Date.now()
  });
  try {
    const res = await fetch(`${API_URL}?${params.toString()}`, {cache:'no-store'});
    const data = await res.json();
    if (!data.success) throw new Error();
    renderList(data.students);
  } catch {
    showState('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§','error');
    setCount(0);
  }
}

const debouncedFetch = debounce(fetchData,300);
searchInput.addEventListener('input',debouncedFetch);
rollFilter.addEventListener('change',fetchData);
classFilter.addEventListener('change',fetchData);

// Initial load
fetchData();
</script>
</body>
</html>